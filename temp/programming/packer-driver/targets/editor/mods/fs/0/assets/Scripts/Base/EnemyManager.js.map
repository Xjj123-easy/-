{"version":3,"sources":["file:///E:/cocosproject/Dome/cocos-start-demo/assets/Scripts/Base/EnemyManager.ts"],"names":["EnemyManager","_decorator","EVENTMANAGER","DRIECTION_ENUM","ENTINY_STATE_ENUM","EnityManger","EventManager","DataManager","ccclass","property","TILE_HEIGHT","TILE_WIDTH","ANIMATION_SPEED","init","params","Instance","on","PLAYERMOVE_END","changeDirection","PLAYER_BORN","ATTACK_ENEMY","onDead","onDestroy","off","destroy","isInit","player","state","DEATH","x","playerX","y","playerY","dix","Math","abs","diy","direction","TOP","RIGHT","LEFT","BOTTOM","id"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  Sprite,\n  UITransform,\n  animation,\n  AnimationClip,\n  SpriteFrame,\n  AnimationComponent,\n} from 'cc'\nimport {\n  CONTROLLER_ENMU,\n  EVENTMANAGER,\n  PARAMS_NAME_ENUM,\n  DRIECTION_ENUM,\n  ENTINY_STATE_ENUM,\n  DIRECTION_ORDER_ENUM,\n  ENTITY_TYPE_ENUM,\n} from '../../Enums'\n\nimport { StateMachine } from './StateMachine'\nimport { IEntity } from '../../Level'\nimport { randombyLength } from '../Utiils'\nimport { EnityManger } from './EnityManger'\nimport EventManager from '../RunTime/EventManager'\nimport DataManager from '../RunTime/DataManager'\nconst { ccclass, property } = _decorator\n\nexport const TILE_HEIGHT = 55\nexport const TILE_WIDTH = 55\nexport const ANIMATION_SPEED = 1 / 8\n\nexport class EnemyManager extends EnityManger {\n  async init(params: IEntity) {\n    super.init(params)\n\n    EventManager.Instance.on(EVENTMANAGER.PLAYERMOVE_END, this.changeDirection, this)\n    EventManager.Instance.on(EVENTMANAGER.PLAYER_BORN, this.changeDirection, this)\n    EventManager.Instance.on(EVENTMANAGER.ATTACK_ENEMY, this.onDead, this)\n    this.changeDirection(true)\n  }\n\n  onDestroy() {\n    super.onDestroy()\n    EventManager.Instance.off(EVENTMANAGER.PLAYERMOVE_END, this.changeDirection)\n    EventManager.Instance.off(EVENTMANAGER.PLAYER_BORN, this.changeDirection)\n    EventManager.Instance.off(EVENTMANAGER.ATTACK_ENEMY, this.onDead)\n    this.destroy()\n  }\n  /**\n   * isInit 判断初始化\n   * changeDirection 改变敌人放向\n   * 通过对比敌人坐标跟player坐标在哪个象限\n   * dix diy 表示偏远量 靠近x轴 还是靠近y轴\n   */\n  changeDirection(isInit: boolean = false) {\n    if (!DataManager.Instance.player || this.state === ENTINY_STATE_ENUM.DEATH) {\n      return\n    }\n    const { x: playerX, y: playerY } = DataManager.Instance.player\n\n    const dix = Math.abs(this.x - playerX)\n    const diy = Math.abs(this.y - playerY)\n\n    if (dix === diy && !isInit) {\n      return\n    }\n\n    if (playerX >= this.x && playerY <= this.y) {\n      this.direction = diy > dix ? DRIECTION_ENUM.TOP : DRIECTION_ENUM.RIGHT\n    } else if (playerX <= this.x && playerY <= this.y) {\n      this.direction = diy > dix ? DRIECTION_ENUM.TOP : DRIECTION_ENUM.LEFT\n    } else if (playerX >= this.x && playerY >= this.y) {\n      this.direction = diy > dix ? DRIECTION_ENUM.BOTTOM : DRIECTION_ENUM.RIGHT\n    } else if (playerX <= this.x && playerY >= this.y) {\n      this.direction = diy > dix ? DRIECTION_ENUM.BOTTOM : DRIECTION_ENUM.LEFT\n    }\n  }\n\n  onDead(id: string) {\n    if (this.state === ENTINY_STATE_ENUM.DEATH) {\n      return\n    }\n    if (id === this.id) {\n      this.state = ENTINY_STATE_ENUM.DEATH\n    }\n  }\n}\n"]}