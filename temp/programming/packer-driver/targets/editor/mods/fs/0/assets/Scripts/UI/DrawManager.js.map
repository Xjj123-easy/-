{"version":3,"sources":["file:///E:/cocosproject/Dome/cocos-start-demo/assets/Scripts/UI/DrawManager.ts"],"names":["_decorator","Component","game","Graphics","Color","find","UITransform","BlockInputEvents","ccclass","DURATION","FADE_STATE_ENUM","DrawManager","IDLE","init","ctx","addComponent","ca","findCanvas","block","transfrom","getComponent","setAnchorPoint","setContentSize","width","height","setAlpa","percent","clear","rect","fillColor","fill","enabled","update","precent","totalTime","drution","state","FADE_IN","fadeResolve","FADE_OUT","fadeIn","duration","Promise","re","fadeOut","mask","setTimeout"],"mappings":"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","sourcesContent":["import { _decorator, Component, game, Graphics, Color, find, Node, UITransform, BlockInputEvents } from 'cc'\nconst { ccclass } = _decorator\nexport const DURATION = 500\nenum FADE_STATE_ENUM {\n  IDLE = 'IDLE',\n  FADE_IN = 'FADE_IN',\n  FADE_OUT = 'FADE_OUT',\n}\n@ccclass('DrawManager')\nexport class DrawManager extends Component {\n  private ctx: Graphics\n  private state: FADE_STATE_ENUM = FADE_STATE_ENUM.IDLE\n  private totalTime: number = 0\n  private drution: number = 0\n  private ca: Node\n  private fadeResolve: (value: PromiseLike<null>) => void\n  private block: BlockInputEvents\n  init() {\n    this.ctx = this.addComponent(Graphics)\n    this.ca = this.findCanvas()\n    this.block = this.addComponent(BlockInputEvents)\n    const transfrom = this.getComponent(UITransform)\n    transfrom.setAnchorPoint(0.5, 0.5)\n    transfrom.setContentSize(this.ca.getComponent(UITransform).width, this.ca.getComponent(UITransform).height)\n\n    this.setAlpa(1)\n  }\n  setAlpa(percent: number) {\n    this.ctx.clear()\n    this.ca = this.findCanvas()\n    this.ctx.rect(0, 0, this.ca.getComponent(UITransform).width, this.ca.getComponent(UITransform).height)\n    this.ctx.fillColor = new Color(0, 0, 0, 255 * percent)\n    this.ctx.fill()\n    this.block.enabled = percent === 1\n  }\n\n  findCanvas() {\n    if (this.ca === null) return\n    return find('/Canvas')\n  }\n  update() {\n    const precent = (game.totalTime - this.totalTime) / this.drution\n    switch (this.state) {\n      case FADE_STATE_ENUM.FADE_IN:\n        if (precent < 1) {\n          this.setAlpa(precent)\n        } else {\n          this.setAlpa(1)\n          this.state = FADE_STATE_ENUM.IDLE\n          this.fadeResolve(null)\n        }\n        break\n      case FADE_STATE_ENUM.FADE_OUT:\n        if (precent < 1) {\n          this.setAlpa(1 - precent)\n        } else {\n          this.setAlpa(0)\n          this.fadeResolve(null)\n          this.state = FADE_STATE_ENUM.IDLE\n        }\n        break\n      default:\n        break\n    }\n  }\n  fadeIn(duration: number = DURATION) {\n    this.setAlpa(1)\n    this.drution = duration\n    this.state = FADE_STATE_ENUM.FADE_IN\n    this.totalTime = game.totalTime\n    return new Promise(re => {\n      this.fadeResolve = re\n    })\n  }\n  fadeOut(duration: number = DURATION) {\n    this.setAlpa(0)\n    this.drution = duration\n    this.state = FADE_STATE_ENUM.FADE_OUT\n    this.totalTime = game.totalTime\n    return new Promise(re => {\n      this.fadeResolve = re\n    })\n  }\n  mask() {\n    this.setAlpa(1)\n    return new Promise(re => {\n      setTimeout(re, this.drution)\n    })\n  }\n}\n"]}