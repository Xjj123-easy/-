{"version":3,"sources":["file:///E:/cocosproject/Dome/cocos-start-demo/assets/Scripts/WoodenSkeleton/WoodenSkeletonSubMachine.ts"],"names":["_decorator","Animation","ENTINY_STATE_ENUM","PARAMS_NAME_ENUM","EnityManger","GetParamsNUmber","GetParamsTrigger","StateMachine","AttackSubStateMachines","DeathSubStateMachines","IdleSubStateMachines","ccclass","property","WoodenSkeletonSubMachine","init","animationComponent","node","addComponent","initParams","initStateMachine","initEventMachine","Promise","all","waitingList","on","EventType","FINISHED","name","defaultClip","whiteList","some","v","includes","getComponent","state","IDLE","param","set","DRIECTION","ATTACK","DEATH","stateMachine","run","currentState","get","value"],"mappings":"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","sourcesContent":["import { _decorator, Animation } from 'cc'\nimport { ENTINY_STATE_ENUM, PARAMS_NAME_ENUM } from '../../Enums'\nimport { EnityManger } from '../Base/EnityManger'\nimport { GetParamsNUmber, GetParamsTrigger, StateMachine } from '../Base/StateMachine'\nimport AttackSubStateMachines from './AttackSubStateMachines'\nimport DeathSubStateMachines from './DeathSubStateMachines'\n\nimport IdleSubStateMachines from './IdleSubStateMachines'\n\nconst { ccclass, property } = _decorator\n\n@ccclass('WoodenSkeletonSubMachine')\nexport class WoodenSkeletonSubMachine extends StateMachine {\n  async init() {\n    this.animationComponent = this.node.addComponent(Animation)\n\n    this.initParams()\n\n    this.initStateMachine()\n\n    this.initEventMachine()\n\n    await Promise.all(this.waitingList)\n  }\n\n  initEventMachine() {\n    this.animationComponent.on(Animation.EventType.FINISHED, () => {\n      const name = this.animationComponent.defaultClip.name //获取动画名字\n      const whiteList = ['attack']\n      if (whiteList.some(v => name.includes(v))) {\n        //匹配是否含有turn再设置状态\n        this.node.getComponent(EnityManger).state = ENTINY_STATE_ENUM.IDLE\n      }\n    })\n  }\n\n  //初始化状态机参数\n  initParams() {\n    this.param.set(PARAMS_NAME_ENUM.IDLE, GetParamsTrigger())\n    this.param.set(PARAMS_NAME_ENUM.DRIECTION, GetParamsNUmber())\n    this.param.set(PARAMS_NAME_ENUM.ATTACK, GetParamsTrigger())\n    this.param.set(PARAMS_NAME_ENUM.DEATH, GetParamsTrigger())\n  }\n\n  initStateMachine() {\n    this.stateMachine.set(PARAMS_NAME_ENUM.IDLE, new IdleSubStateMachines(this))\n    this.stateMachine.set(PARAMS_NAME_ENUM.ATTACK, new AttackSubStateMachines(this))\n    this.stateMachine.set(PARAMS_NAME_ENUM.DEATH, new DeathSubStateMachines(this))\n  }\n  run() {\n    switch (this.currentState) {\n      case this.stateMachine.get(PARAMS_NAME_ENUM.IDLE):\n      case this.stateMachine.get(PARAMS_NAME_ENUM.DEATH):\n      case this.stateMachine.get(PARAMS_NAME_ENUM.ATTACK):\n        if (this.param.get(PARAMS_NAME_ENUM.ATTACK).value) {\n          this.currentState = this.stateMachine.get(PARAMS_NAME_ENUM.ATTACK)\n        } else if (this.param.get(PARAMS_NAME_ENUM.IDLE).value) {\n          this.currentState = this.stateMachine.get(PARAMS_NAME_ENUM.IDLE)\n        } else if (this.param.get(PARAMS_NAME_ENUM.DEATH).value) {\n          this.currentState = this.stateMachine.get(PARAMS_NAME_ENUM.DEATH)\n        } else {\n          this.currentState = this.currentState\n        }\n        break\n      default:\n        this.currentState = this.stateMachine.get(PARAMS_NAME_ENUM.IDLE)\n    }\n  }\n}\n"]}