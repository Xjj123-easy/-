{"version":3,"sources":["file:///E:/cocosproject/Dome/cocos-start-demo/assets/Scripts/WoodenSkeleton/WoodenSkeletonManager.ts"],"names":["_decorator","EVENTMANAGER","ENTINY_STATE_ENUM","EnemyManager","DataManager","EventManager","WoodenSkeletonSubMachine","ccclass","property","WoodenSkeletonManager","init","params","fsm","addComponent","Instance","on","PLAYERMOVE_END","onAttack","update","onDestroy","off","state","DEATH","x","playerX","y","playerY","playState","player","Math","abs","AIRDEATH","emit","ATTACK_PLAYER","console","log","ATTACK","IDLE"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;;AAGPC,MAAAA,Y,iBAAAA,Y;AAGAC,MAAAA,iB,iBAAAA,iB;;AAKOC,MAAAA,Y,iBAAAA,Y;;AACFC,MAAAA,W;;AACAC,MAAAA,Y;;AACEC,MAAAA,wB,iBAAAA,wB;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;uCAEjBS,qB,WADZF,OAAO,CAAC,uBAAD,C,gBAAR,MACaE,qBADb;AAAA;AAAA,wCACwD;AAChDC,QAAAA,IAAI,CAACC,MAAD,EAAkB;AAAA;AAAA;;AAAA;AAC1B,YAAA,KAAI,CAACC,GAAL,GAAW,KAAI,CAACC,YAAL;AAAA;AAAA,qEAAX;AAEA,kBAAM,KAAI,CAACD,GAAL,CAASF,IAAT,EAAN;;AAEA,6CAAWC,MAAX;;AACA;AAAA;AAAA,8CAAaG,QAAb,CAAsBC,EAAtB,CAAyB;AAAA;AAAA,8CAAaC,cAAtC,EAAsD,KAAI,CAACC,QAA3D,EAAqE,KAArE;AAN0B;AAO3B;;AACDC,QAAAA,MAAM,GAAG;AACP,gBAAMA,MAAN;AACD;;AACDC,QAAAA,SAAS,GAAG;AACV,gBAAMA,SAAN;AAEA;AAAA;AAAA,4CAAaL,QAAb,CAAsBM,GAAtB,CAA0B;AAAA;AAAA,4CAAaJ,cAAvC,EAAuD,KAAKC,QAA5D;AACD;AACD;AACF;AACA;AACA;AACA;AACA;;;AAEEA,QAAAA,QAAQ,GAAG;AACT,cAAI,KAAKI,KAAL,KAAe;AAAA;AAAA,sDAAkBC,KAArC,EAA4C;AAC1C;AACD;;AAED,cAAM;AAAEC,YAAAA,CAAC,EAAEC,OAAL;AAAcC,YAAAA,CAAC,EAAEC,OAAjB;AAA0BL,YAAAA,KAAK,EAAEM;AAAjC,cAA+C;AAAA;AAAA,0CAAYb,QAAZ,CAAqBc,MAA1E;;AACA,cACE,CAAE,KAAKL,CAAL,KAAWC,OAAX,IAAsBK,IAAI,CAACC,GAAL,CAAS,KAAKL,CAAL,GAASC,OAAlB,KAA8B,CAArD,IACE,KAAKD,CAAL,KAAWC,OAAX,IAAsBG,IAAI,CAACC,GAAL,CAAS,KAAKP,CAAL,GAASC,OAAlB,KAA8B,CADvD,KAEAG,SAAS,KAAK;AAAA;AAAA,sDAAkBI,QAFhC,IAGAJ,SAAS,KAAK;AAAA;AAAA,sDAAkBL,KAJlC,EAKE;AACA;AAAA;AAAA,8CAAaR,QAAb,CAAsBkB,IAAtB,CAA2B;AAAA;AAAA,8CAAaC,aAAxC,EAAuD;AAAA;AAAA,wDAAkBX,KAAzE;AAEAY,YAAAA,OAAO,CAACC,GAAR,CAAY,KAAKZ,CAAL,KAAWC,OAAX,IAAsBK,IAAI,CAACC,GAAL,CAAS,KAAKL,CAAL,GAASC,OAAlB,KAA8B,CAAhE;AACAQ,YAAAA,OAAO,CAACC,GAAR,CAAY,KAAKV,CAAL,KAAWC,OAAX,IAAsBG,IAAI,CAACC,GAAL,CAAS,KAAKP,CAAL,GAASC,OAAlB,KAA8B,CAAhE;AAEAU,YAAAA,OAAO,CAACC,GAAR,CAAYR,SAAZ;AAEA,iBAAKN,KAAL,GAAa;AAAA;AAAA,wDAAkBe,MAA/B;AACD,WAdD,MAcO;AACL,iBAAKf,KAAL,GAAa;AAAA;AAAA,wDAAkBgB,IAA/B;AACD;AACF;;AA/CqD,O","sourcesContent":["import { _decorator } from 'cc'\nimport {\n  CONTROLLER_ENMU,\n  EVENTMANAGER,\n  PARAMS_NAME_ENUM,\n  DRIECTION_ENUM,\n  ENTINY_STATE_ENUM,\n  DIRECTION_ORDER_ENUM,\n  ENTITY_TYPE_ENUM,\n} from '../../Enums'\nimport { IEntity } from '../../Level'\nimport { EnemyManager } from '../Base/EnemyManager'\nimport DataManager from '../RunTime/DataManager'\nimport EventManager from '../RunTime/EventManager'\nimport { WoodenSkeletonSubMachine } from './WoodenSkeletonSubMachine'\n\nconst { ccclass, property } = _decorator\n@ccclass('WoodenSkeletonManager')\nexport class WoodenSkeletonManager extends EnemyManager {\n  async init(params: IEntity) {\n    this.fsm = this.addComponent(WoodenSkeletonSubMachine)\n\n    await this.fsm.init()\n\n    super.init(params)\n    EventManager.Instance.on(EVENTMANAGER.PLAYERMOVE_END, this.onAttack, this)\n  }\n  update() {\n    super.update()\n  }\n  onDestroy() {\n    super.onDestroy()\n\n    EventManager.Instance.off(EVENTMANAGER.PLAYERMOVE_END, this.onAttack)\n  }\n  /**\n   * isInit 判断初始化\n   * changeDirection 改变敌人放向\n   * 通过对比敌人坐标跟player坐标在哪个象限\n   * dix diy 表示偏远量 靠近x轴 还是靠近y轴\n   */\n\n  onAttack() {\n    if (this.state === ENTINY_STATE_ENUM.DEATH) {\n      return\n    }\n\n    const { x: playerX, y: playerY, state: playState } = DataManager.Instance.player\n    if (\n      ((this.x === playerX && Math.abs(this.y - playerY) <= 1) ||\n        (this.y === playerY && Math.abs(this.x - playerX) <= 1)) &&\n      playState !== ENTINY_STATE_ENUM.AIRDEATH &&\n      playState !== ENTINY_STATE_ENUM.DEATH\n    ) {\n      EventManager.Instance.emit(EVENTMANAGER.ATTACK_PLAYER, ENTINY_STATE_ENUM.DEATH)\n\n      console.log(this.x === playerX && Math.abs(this.y - playerY) <= 1)\n      console.log(this.y === playerY && Math.abs(this.x - playerX) <= 1)\n\n      console.log(playState)\n\n      this.state = ENTINY_STATE_ENUM.ATTACK\n    } else {\n      this.state = ENTINY_STATE_ENUM.IDLE\n    }\n  }\n}\n"]}